<!doctype html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="Philipp Engler">
		<meta name="generator" content="Jekyll v4.1.1">
		<title>eufy Security AddOn für HomeMatic</title>
		
		<!-- Bootstrap core CSS -->
		<link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">
		
		<!-- Bootstrap icon font CSS -->
		<link href="assets/dist/css/bootstrap-icons.css" rel="stylesheet">
		
		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			
			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}
		</style>
		
		<!-- Custom styles for this template -->
		<link href="assets/dist/css/navbar-top-fixed.css" rel="stylesheet">
		<link href="assets/dist/css/footer.css" rel="stylesheet">
	</head>
	<body>
		<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
			<a id="lnkMain" class="navbar-brand" href="/addons/eufySecurity">eufy Security AddOn für HomeMatic</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarCollapse">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a id="lnkHome" class="nav-link" href="/addons/eufySecurity">Home</a>
					</li>
					<li class="nav-item">
						<a id="lnkDevices" class="nav-link" href="devices.html">Geräte</a>
					</li>
					<li class="nav-item">
						<a id="lnkStatechange" class="nav-link" href="statechange.html">Statusänderung</a>
					</li>
					<li class="nav-item active">
						<a id="lnkSettings" class="nav-link" href="settings.html">Einstellungen<span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a id="lnkLogfiles" class="nav-link" href="logfiles.html">Logdateien</a>
					</li>
					<li class="nav-item">
						<a id="lnkInfo" class="nav-link" href="info.html">Über</a>
					</li>
				</ul>
			</div>
		</nav>
		
		<main role="main" class="container-fluid">
			<div id="browserWarning">
			</div>
			<div id="loadApiSettingsError">
			</div>
			<div id="content">
				<form class="needs-validation" novalidate action="javascript:saveConfig();" method="post" id="configform">
					<h3>Einstellungen</h3>
					<p>
						<div id="resultLoading">

						</div>
						<div id="resultMessage">

						</div>
					</p>
				
					<div class="row">
						<div class="col">
							<div class="card mb-3">
								<h5 class="card-header"><i class="bi-person-circle"></i>&nbsp;&nbsp;eufy Security Account</h5>
								<div class="row no-gutters">
									<div class="col-md-12">
										<div class="card-body" >
											<h5>Zugangsdaten</h5>
											<div class="alert alert-warning alert-dismissible fade show" role="alert">
												Bitte erzeugen Sie einen eigenen eufy Security Account für dieses AddOn und geben Sie dessen Zugangsdaten hier ein.<br />
												<small class="form-text text-muted">Wenn Sie keinen zusätzlichen Account anlegen, werden Sie jedes mal in Ihrer App abgemeldet, wenn dieses AddOn mit eufy Security kommuniziert bzw. das AddOn wird abgemeldet, wenn Sie Ihre App nutzen.</small>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label for="txtUsername">Benutzername des angelegten eufy Security Accounts.</label>
												<input type="email" name="username" id="txtUsername" class="form-control" placeholder="eMail-Adresse" required> <!--autofocus-->
												<small class="form-text text-muted">Der Benutzername ist die eMail-Adresse, mit der Sie den eufy Security Account angelegt haben.</small>
												<div class="invalid-feedback">
													Bitte geben Sie die eMail-Adresse des eufy Security Accounts ein.
												</div>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtPassword">Passwort des angelegten eufy Security Accounts.</label>
												<input type="password" name="password" id="txtPassword" class="form-control" placeholder="Password" required>
												<small class="form-text text-muted">Das Passwort, dass Sie für den eufy Security Account angelegt haben.</small>
												<div class="invalid-feedback">
													Bitte geben Sie das Passwort des eufy Security Accounts ein.
												</div>
											</div>
											<hr>
											<h5>Weitere Einstellungen</h5>
											<div class="form-label-group was-validated" class="container-fluid">
												<label for="cbLocation">Standort des eufy Security Accounts.</label>
												<select name="location" id="cbLocation" class="custom-select" required>
													<option disabled selected value style="display: none;">Bitte auswählen...</option>
													<option disabled value="-1">automatische Auswahl</option>
													<option disabled value="0">alle Regionen außer Europa</option>
													<option value="1">Europa</option>
												</select>
												<small class="form-text text-muted">Der Standort, für den Sie den eufy Security Account erstellt haben. Auch wenn Sie hier einen anderen Wert angeben, verbindet sich der Client trotzdem mit der richtigen Region. Diese wird ihm von eufy mitgeteilt, wenn er sich bei einem fremden Standort anmeldet.</small>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="cbCountry">Land des eufy Security Accounts.</label>
												<select name="location" id="cbCountry" class="custom-select" required>
													<option disabled selected value style="display: none;">Bitte auswählen...</option>
													<option value="DE">Deutschland</option>
													<option value="AT">Österreich</option>
													<option value="CH">Schweiz</option>
												</select>
												<small class="form-text text-muted">Das Land, für den Sie den eufy Security Account erstellt haben.</small>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="cbLanguage">Land des eufy Security Accounts.</label>
												<select name="location" id="cbLanguage" class="custom-select" required>
													<option disabled selected value style="display: none;">Bitte auswählen...</option>
													<option value="de">deutsch</option>
													<option value="en">englisch</option>
												</select>
												<small class="form-text text-muted">Die Sprache, die für den eufy Security Account genutzt wird.</small>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="card mb-3">
								<h5 class="card-header"><i class="bi-sliders"></i>&nbsp;&nbsp;Konfiguration des AddOns</h5>
								<div class="row no-gutters">
									<div class="col-md-12">
										<div class="card-body" >
											<h5>Einstellungen für HTTP</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useHttp" class="custom-control-input" id="chkUseHttp" onchange="changeValue(useHttp)">
												<label class="custom-control-label" for="chkUseHttp">HTTP aktiv</label>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtPortHttp">Port über den die eufy Security API über HTTP erreichbar sein soll.</label>
												<input type="text" name="httpPort" id="txtPortHttp" class="form-control" placeholder="API-Port" pattern="^(1|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$" required>
												<small class="form-text text-muted">Der angegebene Port darf nicht in Verwendung sein.</small>
												<div class="invalid-feedback">
													Bitte geben Sie eine Zahl zwischen 1 und 65535 ein.
												</div>
											</div>
											<hr>
											<h5>Einstellungen für HTTPS</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useHttps" class="custom-control-input" id="chkUseHttps" onchange="changeValue(useHttps)">
												<label class="custom-control-label" for="chkUseHttps">HTTPS aktiv</label>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="portHttpsport">Port über den die eufy Security API über HTTPS erreichbar sein soll.</label>
												<input type="text" name="httpsPort" id="txtPortHttps" class="form-control" placeholder="API-Port" pattern="^(1|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$" required>
												<small class="form-text text-muted">Der angegebene Port darf nicht in Verwendung sein.</small>
												<div class="invalid-feedback">
													Bitte geben Sie eine Zahl zwischen 1 und 65535 ein.
												</div>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtHttpsKeyFile">Speicherort der Datei mit dem privaten Schlüssel des Zertifikats.</label>
												<input type="text" name="httpsKeyFile" id="txtHttpsKeyFile" class="form-control" placeholder="Schlüsseldatei" required>
												<small class="form-text text-muted">Speicherort der Schlüsseldatei auf der CCU.</small>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtHttpsCertFile">Speicherort des Zertifikats.</label>
												<input type="text" name="httpsCertFile" id="txtHttpsCertFile" class="form-control" placeholder="Zertifikatsdatei" required>
												<small class="form-text text-muted">Speicherort der Zertifikatsdatei auf der CCU.</small>
											</div>
											<hr>
											<h5>Einstellungen für die Verbindung zu den Basisstationen</h5>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mb-2" for="cbConnectionType">Herstellen der Verbindung zu den Basisstationen.</label>
												<select name="connectionType" id="cbConnectionType" class="custom-select mb-2" required>
													<option disabled selected value style="display: none;">Bitte auswählen...</option>
													<option value="0">bevorzuge lokale Verbindung</option>
													<option value="1">nur lokale Verbindung</option>
													<option value="2">schnellste Verbindung</option>
												</select>
											</div>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useUdpStaticPorts" class="custom-control-input mt-2 mb-2" id="chkUseUdpStaticPorts" onchange="changeValue(useUdpStaticPorts)">
												<label class="custom-control-label mt-2" for="chkUseUdpStaticPorts">Verbindung zu den Basisstation über feste Ports aufbauen</label>
											</div>
											<div class="form-label-group was-validated" class="container-fluid" id="useUDPStaticPortsBases">
												
											</div>
											<hr>
											<h5>Einstellungen für die Aktualisierung der Systemvariablen</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useSystemVariables" class="custom-control-input" id="chkUseSystemVariables" onchange="changeValue(useSystemVariables)">
												<label class="custom-control-label" for="chkUseSystemVariables">Systemvariablen bei API Aktionen automatisch aktualisieren</label>
											</div>
											<hr>
											<h5>Einstellungen für Standardbild der Kameras</h5>
											<div class="form-label-group" class="container-fluid">
												<label for="txtDefaultImagePath">Standardbild für Kameras.</label>
												<input type="text" name="defaultImagePath" id="txtDefaultImagePath" class="form-control" placeholder="Link zum Standardbild.">
												<small class="form-text text-muted">Wenn die für die jeweilige Kamera kein Standbild zur Verfügung steht, wird dieser Link in der entsprechenden Systemvariable gesetzt.</small>
											</div>
											<hr>
											<h5>Einstellungen für Standardvideo der Kameras</h5>
											<div class="form-label-group" class="container-fluid">
												<label for="txtDefaultVideoPath">Standardvideo für Kameras.</label>
												<input type="text" name="defaultVideoPath" id="txtDefaultVideoPath" class="form-control" placeholder="Link zum Standardvideo.">
												<small class="form-text text-muted">Wenn die für die jeweilige Kamera kein Video zur Verfügung steht, wird dieser Link in der entsprechenden Systemvariable gesetzt.</small>
											</div>
											<hr>
											<h5>Einstellungen für regelmäßige Aktualisierung des Modus</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useUpdateStateEvent" class="custom-control-input" id="chkUpdateStateEvent" onchange="changeValue(useUpdateStateEvent)">
												<label class="custom-control-label" for="chkUpdateStateEvent">Modus automatisch durch von der HomeBase gesendete Ereignisse aktualisieren</label>
												<!--<small class="form-text text-muted">Statusänderungen werden von der HomeBase direkt nach einer externen Änderung gemeldet und aktualisiert.</small>-->
											</div>
											<div class="custom-control custom-switch mt-2">
												<input type="checkbox" name="useUpdateStateIntervall" class="custom-control-input" id="chkUpdateStateIntervall" onchange="changeValue(useUpdateStateIntervall)">
												<label class="custom-control-label" for="chkUpdateStateIntervall">Modus regelmäßig intervallbasierend aktualisieren</label>
												<!--<small class="form-text text-muted">Status wird in regelmäßigen Abständen abgerufen.</small>-->
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtUpdateStateIntervallTimespan">Zeit zwischen den Aktualisierungen.</label>
												<input type="text" name="updateStateIntervallTimespan" id="txtUpdateStateIntervallTimespan" class="form-control" placeholder="Intervall zwischen Aktualisierungen." pattern="^(1[5-9]|[2-9][0-9]|1[0-9]{2}|2[0-3][0-9]|240)$" required>
												<small class="form-text text-muted">Intervall in Minuten.</small>
												<div class="invalid-feedback">
													Bitte geben Sie ein Intervall zwischen 15 und 240 Minuten ein.
												</div>
											</div>
											<hr>
											<h5>Einstellungen für regelmäßige Aktualisierung der Links</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="useUpdateLinksIntervall" class="custom-control-input" id="chkUseUpdateLinksIntervall" onchange="changeValue(useUpdateLinksIntervall)">
												<label class="custom-control-label" for="chkUseUpdateLinksIntervall">Links regelmäßig aktualisieren</label>
											</div>
											<div class="custom-control custom-switch mt-2">
												<input type="checkbox" name="useUpdateLinksOnlyWhenActive" class="custom-control-input" id="chkUpdateLinksOnlyWhenActive">
												<label class="custom-control-label" for="chkUpdateLinksOnlyWhenActive">Links nur regelmäßig aktualisieren, wenn System aktiv ist</label>
											</div>
											<div class="form-label-group was-validated" class="container-fluid">
												<label class="mt-2" for="txtUpdateLinksIntervallTimespan">Zeit zwischen den Aktualisierungen.</label>
												<input type="text" name="updateLinksIntervallTimespan" id="txtUpdateLinksIntervallTimespan" class="form-control" placeholder="Intervall zwischen Aktualisierungen." pattern="^(1[5-9]|[2-9][0-9]|1[0-9]{2}|2[0-3][0-9]|240)$" required>
												<small class="form-text text-muted">Intervall in Minuten.</small>
												<div class="invalid-feedback">
													Bitte geben Sie ein Intervall zwischen 15 und 240 Minuten ein.
												</div>
											</div>
											<hr>
											<h5>Einstellungen für Pushbenachrichtigungen</h5>
											<div class="custom-control custom-switch">
												<input type="checkbox" name="usePushService" class="custom-control-input" id="chkUsePushService">
												<label class="custom-control-label" for="chkUsePushService">Pushbenachrichtigungen aktivieren</label>
											</div>
											<hr>
											<h5>Einstellungen für Protokollierung</h5>
											<div class="form-label-group" class="container-fluid">
												<label for="cbLogLevel">Umfang der Protokollierung.</label>
												<div id="alertLogLevel">
												</div>
												<select name="logLevel" id="cbLogLevel" class="custom-select" oninput="checkLogLevel(this.value);" required>
													<option disabled selected value style="display: none;">Bitte auswählen...</option>
													<option value="0">grundlegende Informationen</option>
													<option value="1">alle Informationen</option>
													<option value="2">alle Informationen, alle Fehler</option>
													<option value="3">alle Informationen, alle Fehler, alle Debuginformationen</option>
												</select>
												<small class="form-text text-muted">Legt den Umfang der Protokollierung fest. Fehler werden unabhängig dieser Einstellung beim Auftreten immer in der Fehlerprotokolldatei 'eufySecurity.err' protokolliert.</small>
												<div class="invalid-feedback">
													Bitte wählen Sie eine Protokollierungsstufe aus.
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="mb-3">
								<button type="submit" class="btn btn-primary">Einstellungen speichern</button><br />
							</div>

							<div class="card mb-3">
								<h5 class="card-header"><i class="bi-table"></i>&nbsp;&nbsp;Systemvariablen</h5>
								<div class="row no-gutters">
									<div class="col-md-12">
										<div class="card-body">
											<div id="divSystemVariablesHint">
											</div>
											<div id="divSystemVariables">
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="card mb-3">
								<h5 class="card-header"><i class="bi-tools"></i>&nbsp;&nbsp;Fehlerbehebung</h5>
								<div class="row no-gutters">
									<div class="col-md-12">
										<div class="card-body" >
											<div class="alert alert-warning fade show" role="alert">
												<div class="row row-cols-12 row-cols-sm-12 row-cols-md-12 row-cols-lg-12 row-cols-xl-12 align-items-center">
													<div class="col-5 col-sm-4 col-md-3 col-lg-2 col-xl-2">
														<div id="enableTS"><button id="btnEnableTroubleShooting" onclick="enableButtons(true)" type="button" class="btn btn-outline-warning btn-block">Fehlerbehebung aktivieren</button></div>
													</div>
													<div class="col-7 col-sm-8 col-md-9 col-lg-10 col-xl-10">
														Mit den folgenden Buttons können Sie verschiedene Aufgaben ausführen, um die Funktionsfähigkeit des AddOns wiederherzustellen. Um ungewollte Änderungen zu vermeiden, müssen Sie die Bearbeitung für einige Aufgaben zuerst freischalten.<br />
														<small class="form-text text-muted">Bitte beachten Sie, dass Sie mit diesen Funktionen unter Umständen Daten und Einstellungen löschen oder verändern.</small>
													</div>
												</div>
											</div>
											<div class="form-label-group" class="container-fluid">
												<label for="btnDownloadConfigFile">Sie haben die Möglichkeit, Ihre aktuelle Konfiguration herunterzuladen.<br /><small class="form-text text-muted">Bitte beachten Sie, dass diese Datei Ihre Zugangsdaten im Klartext enthält.</small></label><br />
												<button id="btnDownloadConfigFile" onclick="downloadConfigFile()" type="button" class="btn btn-outline-primary">Konfiguration herunterladen</button>
											</div>
											<hr />
											<div class="form-label-group" class="container-fluid">
												<label id="lblDeleteTokenData" for="btnDeleteTokenData" class="text-muted">Wenn Sie in der Logdatei den Fehler <code>401 (Unauthorized)</code> erhalten, können Sie versuchen, das vorhandene Token zu löschen. Dadurch wird bei der nächsten Anfrage ein neues Token erzeugt.</label><br />
												<button id="btnDeleteTokenData" onclick="removeTokenData()" type="button" class="btn btn-outline-primary" disabled>Token löschen</button>
											</div>
											<hr />
											<div class="form-label-group" class="container-fluid">
												<label id="lblRestartService" for="btnRestartService" class="text-muted">Unter Umständen kann es notwendig sein, den Service neu zu starten. Dabei werden alle bereits übertragenen Änderungen gespeichert und der Service neu gestartet.</label><br />
												<button id="btnRestartService" onclick="restartService()" type="button" class="btn btn-outline-primary" disabled>Service neu starten</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</main>
		
		<footer class="footer">
			<div class="container-fluid">
				<span class="text-muted">&copy; 2020-2021 Philipp Engler</span>
			</div>
		</footer>
		
		<div id="toastCheckConfigFailed" class="toast bg-danger" role="alert" data-autohide="true" data-delay="15000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Überprüfung der Eingaben.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Die Überprüfung der Eingaben ist fehlgeschlagen. Bitte überprüfen Sie die rot markierten Eingabefelder und beachten Sie die Hinweise.
			</div>
		</div>

		<div id="toastSaveConfigOK" class="toast bg-success" role="alert" data-autohide="true" data-delay="5000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Speicherung der Einstellungen.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Die Einstellungen wurden erfolgreich gespeichert.
			</div>
		</div>

		<div id="toastSaveConfigOKRestart" class="toast bg-success" role="alert" data-autohide="true" data-delay="7000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Speicherung der Einstellungen.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Die Einstellungen wurden erfolgreich gespeichert. Der Service wird neu gestartet.
			</div>
		</div>
		
		<div id="toastSaveConfigFailed" class="toast bg-danger" role="alert" data-autohide="true" data-delay="15000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Speicherung der Einstellungen.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Bei dem Speichern der Einstellungen ist ein Fehler aufgetreten.
			</div>
		</div>
		
		<div id="toastRemoveTokenOK" class="toast bg-success" role="alert" data-autohide="true" data-delay="5000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Tokendaten löschen.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Die Tokendaten wurden erfolgreich gelöscht.
			</div>
		</div>
		
		<div id="toastRemoveTokenFailed" class="toast bg-danger" role="alert" data-autohide="true" data-delay="5000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Tokendaten löschen.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Bei dem Löschen der Tokendaten ist ein Fehler aufgetreten.
			</div>
		</div>

		<div id="toastRestartOK" class="toast bg-success" role="alert" data-autohide="true" data-delay="7000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Service neu starten.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Der Service wird neu gestartet.
			</div>
		</div>
		
		<div id="toastRestartFailed" class="toast bg-danger" role="alert" data-autohide="true" data-delay="15000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="mr-auto">Service neu starten.</strong>
				<button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
					&times;
				</button>
			</div>
			<div class="toast-body text-white">
				Bei dem Neustart des Services ist ein Fehler aufgetreten.
			</div>
		</div>

		<div class="modal fade" id="modalAtLeastOneNeedsActivation" role="alert" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="lblModalAtLeastOneNeedsActivation" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header alert-danger">
						<h5 class="modal-title" id="lblModalTitle">Einstellungen überprüfen.</h5>
					</div>
					<div class="modal-body">
						Um die Erreichbarkeit der API zu gewährleisten, muss mindestens eine der beiden Optionen ('HTTP aktiv' oder 'HTTPS aktiv') aktiviert sein.<br /><br />
						Mit 'OK' wird die zuletzt deaktivierte Option wieder aktiviert.
					</div>
					<div class="modal-footer alert-secondary">
						<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="modalStateEventOrIntervall" role="alert" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="lblModalStateEventOrIntervall" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header alert-danger">
						<h5 class="modal-title" id="lblModalTitle">Einstellungen überprüfen.</h5>
					</div>
					<div class="modal-body">
						Es kann nicht gleichzeitig die Option "Modus automatisch unmittelbar nach externer Änderung aktualisieren" und die Option "Modus regelmäßig intervallbasierend aktualisieren" aktiviert werden.<br /><br />
						Mit 'OK' bleibt die zuletzt aktivierte Option aktiviert.
					</div>
					<div class="modal-footer alert-secondary">
						<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="modalUDPPortsEqualWrong" role="alert" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="lblModalUDPPortsEqualWrong" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header alert-danger">
						<h5 class="modal-title" id="lblModalTitle">Einstellungen überprüfen.</h5>
					</div>
					<div class="modal-body">
						
					</div>
					<div class="modal-footer alert-secondary">
						<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
					</div>
				</div>
			</div>
		</div>
		
		<script src="assets/dist/js/jquery-3.5.1.slim.min.js"></script>
		<script>window.jQuery || document.write('<script src="assets/dist/js/bootstrap.bundle.min.js"><\/script>')</script>
		<script src="assets/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			port = "";
			checkIE();
			
			function checkIE()
			{
				if (window.document.documentMode)
				{
					var warning = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
					warning += `<h4>Diese Webseite ist nicht für den Internet Explorer entwickelt.</h4>`;
					warning += `Die Funktionalität der Webseite kann beim Internet Explorer nicht sichergestellt werden. Nutzen Sie bitte Firefox, Microsoft Edge, Safari oder einen anderen unterstützen Browser.`;
					warning += `</div>`;
					document.getElementById("browserWarning").innerHTML = warning;
					document.getElementById("content").innerHTML = "";
				}
				else
				{
					if(!(window.location.search == ""))
					{
						addQueryStringToLinks(window.location.search);
					}
					disableUIElements();
					getAPIPort();
				}
			}

			function addQueryStringToLinks(sessionID)
			{
				document.getElementById("lnkMain").setAttribute("href", document.getElementById("lnkHome").getAttribute("href") + sessionID);
				document.getElementById("lnkHome").setAttribute("href", document.getElementById("lnkHome").getAttribute("href") + sessionID);
				document.getElementById("lnkDevices").setAttribute("href", document.getElementById("lnkDevices").getAttribute("href") + sessionID);
				document.getElementById("lnkStatechange").setAttribute("href", document.getElementById("lnkStatechange").getAttribute("href") + sessionID);
				document.getElementById("lnkSettings").setAttribute("href", document.getElementById("lnkSettings").getAttribute("href") + sessionID);
				document.getElementById("lnkLogfiles").setAttribute("href", document.getElementById("lnkLogfiles").getAttribute("href") + sessionID);
				document.getElementById("lnkInfo").setAttribute("href", document.getElementById("lnkInfo").getAttribute("href") + sessionID);
			}

			function getAPIPort()
			{
				var apiPorts;
				var url = `${location.protocol}//${location.hostname}/addons/eufySecurity/apiPorts.txt`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('text/plain');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							apiPorts = this.responseText;
							apiPorts = apiPorts.split(",")
							
							if(apiPorts.length == 2)
							{
								port = apiPorts[0];
								if(location.protocol == "https:")
								{
									port = apiPorts[1];
								}
							}
							else
							{
								port = "52789";
								if(location.protocol == "https:")
								{
									port = "52790";
								}
							}

							initContent();
						}
						catch (e)
						{
							var loadSettingsError = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
							loadSettingsError += `Bei der Ermittlung der API-Ports ist ein Fehler aufgetreten.<br />`;
							loadSettingsError += `<small class="text-muted">Bitte überprüfen Sie die Datei apiPorts.txt im Webseitenverzeichnisses dieses AddOns.</small>`;
							loadSettingsError += `</div>`;
							document.getElementById("loadApiSettingsError").innerHTML = loadSettingsError;;
						}
					}
					else if (this.readyState == 4)
					{
						var loadSettingsError = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
						loadSettingsError += `Bei der Ermittlung der API-Ports ist ein Fehler aufgetreten.<br />`;
						loadSettingsError += `<small class="text-muted">Bitte überprüfen Sie die Datei apiPorts.txt im Webseitenverzeichnisses dieses AddOns.</small>`;
						loadSettingsError += `</div>`;
						document.getElementById("loadApiSettingsError").innerHTML = loadSettingsError;
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}

			function initContent()
			{
				validateForm();
				loadBases();
				loadSystemVariables();
			}

			function disableUIElements()
			{
				document.getElementById("txtUsername").setAttribute("disabled", true);
				document.getElementById("txtPassword").setAttribute("disabled", true);
				document.getElementById("cbLocation").setAttribute("disabled", true);
				document.getElementById("cbCountry").setAttribute("disabled", true);
				document.getElementById("cbLanguage").setAttribute("disabled", true);
				document.getElementById("txtPortHttp").setAttribute("disabled", true);
				document.getElementById("txtPortHttps").setAttribute("disabled", true);
				document.getElementById("txtPortHttps").setAttribute("disabled", true);
				document.getElementById("txtHttpsKeyFile").setAttribute("disabled", true);
				document.getElementById("txtHttpsCertFile").setAttribute("disabled", true);
				document.getElementById("cbConnectionType").setAttribute("disabled", true);
				document.getElementById('txtDefaultImagePath').setAttribute("disabled", true);
				document.getElementById('txtDefaultVideoPath').setAttribute("disabled", true);
				document.getElementById("txtUpdateStateIntervallTimespan").setAttribute("disabled", true);
				document.getElementById("chkUpdateLinksOnlyWhenActive").setAttribute("disabled", true);
				document.getElementById("txtUpdateLinksIntervallTimespan").setAttribute("disabled", true);
				document.getElementById("chkUsePushService").setAttribute("disabled", true);
				document.getElementById("cbLogLevel").setAttribute("disabled", true);
			}

			function enableUIElements()
			{
				document.getElementById("txtUsername").removeAttribute("disabled");
				document.getElementById("txtPassword").removeAttribute("disabled");
				document.getElementById("cbLocation").removeAttribute("disabled");
				document.getElementById("cbCountry").removeAttribute("disabled");
				document.getElementById("cbLanguage").removeAttribute("disabled");
				document.getElementById("cbConnectionType").removeAttribute("disabled");
				document.getElementById('txtDefaultImagePath').removeAttribute("disabled");
				document.getElementById('txtDefaultVideoPath').removeAttribute("disabled");
				document.getElementById("chkUsePushService").removeAttribute("disabled");
				document.getElementById("cbLogLevel").removeAttribute("disabled");
			}

			function validateForm()
			{
				var form = document.getElementById("configform");
				form.addEventListener('submit', function(event)
				{
					if (form.checkValidity() === false)
					{
						event.preventDefault();
						event.stopPropagation();
						$("#toastCheckConfigFailed").toast('show');
					}
					
					//form.classList.add('was-validated');
				}, false);
			}

			function loadBases()
			{
				var xmlHttp, objResp, objIter, bases = "";
				var url = `${location.protocol}//${location.hostname}:${port}/getBases`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								for (objIter in objResp.data)
								{
									bases += `<label class="mt-2" for="txtUdpPortsBase${objResp.data[objIter].base_id}">UDP Port für Verbindung mit HomeBase ${objResp.data[objIter].base_id} (${objResp.data[objIter].name}).</label>`;
									bases += `<input type="text" name="udpPortsBase${objResp.data[objIter].base_id}" id="txtUdpPortsBase${objResp.data[objIter].base_id}" class="form-control" placeholder="UDP Port ${objResp.data[objIter].base_id}" onfocusout="checkUDPPorts(udpPortsBase${objResp.data[objIter].base_id})" required>`;
									bases += `<small class="form-text text-muted">Der angegebene Port darf nicht in Verwendung und keiner anderen Basis zugeordnet sein.</small>`;
									bases += `<div class="invalid-feedback">Bitte geben Sie eine Zahl zwischen 1 und 65535 ein. Diese Zahl darf keiner anderen Basis zugeordnet.</div>`;
								}
								document.getElementById('chkUseUdpStaticPorts').removeAttribute("disabled");
								document.getElementById("useUDPStaticPortsBases").innerHTML = bases;
								loadData();
							}
							else
							{
								document.getElementById("useUDPStaticPortsBases").innerHTML = `<div class="alert alert-danger mt-2" role="alert">Fehler bei der Ermittlung der Basisstationen.</div>`;
								document.getElementById('chkUseUdpStaticPorts').setAttribute("disabled", true);
								loadData();
							}
						}
						catch (e)
						{
							document.getElementById("useUDPStaticPortsBases").innerHTML = `<div class="alert alert-danger mt-2" role="alert">Fehler bei der Ermittlung der Basisstationen.</div>`;
							document.getElementById('chkUseUdpStaticPorts').setAttribute("disabled", true);
							loadData();
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("useUDPStaticPortsBases").innerHTML = `<div class="alert alert-danger mt-2" role="alert">Fehler bei der Ermittlung der Basisstationen.</div>`;
						document.getElementById('chkUseUdpStaticPorts').setAttribute("disabled", true);
						loadData();
					}
					else
					{
						document.getElementById("resultLoading").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Laden der Einstellungen...</strong></div>`;
						document.getElementById("useUDPStaticPortsBases").innerHTML = `<div class="d-flex align-items-center mt-4"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Laden der Basisstationen...</strong></div>`;
						document.getElementById('chkUseUdpStaticPorts').setAttribute("disabled", true);
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}
			
			function loadData()
			{
				var xmlHttp, objResp, objIter, username, password, accountlocation, accountcountry, accountlanguage, apiusehttp, apiporthttp, apiusehttps, apiporthttps, apiconnectiontype, apiuseudplocalstaticports, apiudpports, apiusesystemvariables, apicameradefaultimage, apicameradefaultvideo, apiuseupdatestateevent, apiuseupdatestateintervall, apiupdatestatetimespan, apiuseupdatelinks, apiuseupdatelinksonlywhenactive, apiupdatelinkstimespan, api_use_pushservice, apiloglevel;
				var url = `${location.protocol}//${location.hostname}:${port}/getConfig`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								for (objIter in objResp.data)
								{
									username = objResp.data[objIter].username;
									password = objResp.data[objIter].password;
									accountlocation = objResp.data[objIter].location;
									accountcountry = objResp.data[objIter].country;;
									accountlanguage = objResp.data[objIter].language;;
									apiusehttp = objResp.data[objIter].api_http_active;
									apiporthttp = objResp.data[objIter].api_http_port;
									apiusehttps = objResp.data[objIter].api_https_active;
									apiporthttps = objResp.data[objIter].api_https_port;
									apikeyhttps = objResp.data[objIter].api_https_key_file;
									apicerthttps = objResp.data[objIter].api_https_cert_file;
									apiconnectiontype = objResp.data[objIter].api_connection_type;
									apiuseudplocalstaticports = objResp.data[objIter].api_udp_local_static_ports_active;
									apiudpports = objResp.data[objIter].api_udp_local_static_ports;
									apiusesystemvariables = objResp.data[objIter].api_use_system_variables;
									apicameradefaultimage = objResp.data[objIter].api_camera_default_image;
									apicameradefaultvideo = objResp.data[objIter].api_camera_default_video;
									apiuseupdatestateevent = objResp.data[objIter].api_use_update_state_event;
									apiuseupdatestateintervall = objResp.data[objIter].api_use_update_state_intervall;
									apiupdatestatetimespan = objResp.data[objIter].api_update_state_timespan;
									apiuseupdatelinks = objResp.data[objIter].api_use_update_links;
									apiuseupdatelinksonlywhenactive =objResp.data[objIter].api_use_update_links_only_when_active;
									apiupdatelinkstimespan = objResp.data[objIter].api_update_links_timespan;
									apiusepushservice = objResp.data[objIter].api_use_pushservice;
									apiloglevel = objResp.data[objIter].api_log_level;
								}
								var text = document.getElementById('txtUsername');
								text.value = username;
								text = document.getElementById('txtPassword');
								text.value = password;
								if(accountlocation == undefined || accountlocation < "-1" || accountlocation > "1" )
								{
									document.getElementById("cbLocation").selectedIndex = "";
								}
								else
								{
									document.getElementById("cbLocation").value = (Number.parseInt(accountlocation));
								}
								if(accountcountry == undefined || accountcountry == "" )
								{
									document.getElementById("cbCountry").selectedIndex = "";
								}
								else
								{
									document.getElementById("cbCountry").value = accountcountry;
								}
								if(accountlanguage == undefined || accountlanguage == "" )
								{
									document.getElementById("cbLanguage").selectedIndex = "";
								}
								else
								{
									document.getElementById("cbLanguage").value = accountlanguage;
								}
								if(apiusehttp == "true")
								{
									document.getElementById("chkUseHttp").setAttribute("checked", true);
									document.getElementById("txtPortHttp").removeAttribute("disabled");
								}
								else
								{
									document.getElementById("txtPortHttp").setAttribute("disabled", true);
								}
								text = document.getElementById('txtPortHttp');
								text.value = apiporthttp;
								if(apiusehttps == "true")
								{
									document.getElementById("chkUseHttps").setAttribute("checked", true);
									document.getElementById("txtPortHttps").removeAttribute("disabled");
									document.getElementById("txtHttpsKeyFile").removeAttribute("disabled");
									document.getElementById("txtHttpsCertFile").removeAttribute("disabled");
								}
								else
								{
									document.getElementById("txtPortHttps").setAttribute("disabled", true);
									document.getElementById("txtHttpsKeyFile").setAttribute("disabled", true);
									document.getElementById("txtHttpsCertFile").setAttribute("disabled", true);
								}
								text = document.getElementById('txtPortHttps');
								text.value = apiporthttps;
								text = document.getElementById('txtHttpsKeyFile');
								text.value = apikeyhttps;
								text = document.getElementById('txtHttpsCertFile');
								text.value = apicerthttps;
								if(apiconnectiontype == undefined || (apiconnectiontype != "0" && apiconnectiontype != "1" && apiconnectiontype != "2"))
								{
									document.getElementById("cbConnectionType").selectedIndex = "";
								}
								else
								{
									document.getElementById("cbConnectionType").selectedIndex = (Number.parseInt(apiconnectiontype)) + 1;
								}
								if(apiusesystemvariables == "true")
								{
									document.getElementById("chkUseSystemVariables").setAttribute("checked", true);
								}
								if(apiuseudplocalstaticports == "true")
								{
									document.getElementById("chkUseUdpStaticPorts").setAttribute("checked", true);
								}
								
								var element = document.getElementsByTagName("INPUT");
								for (var i=0, m=element.length; i<m; i++)
								{
									if(element[i].name.startsWith("udpPortsBase"))
									{
										var tempSerial = element[i].name.replace("udpPortsBase", "");
										var tempPorts = objResp.data[objIter]["api_udp_local_static_ports_" + tempSerial];
										text = document.getElementById('txtUdpPortsBase' + tempSerial);
										if(tempPorts == undefined || tempPorts == "undefined")
										{
											text.value = "";
										}
										else
										{
											text.value = tempPorts;
										}
										changeValue("useUdpStaticPorts");
										
										if(apiuseudplocalstaticports == "false")
										{
											document.getElementById('txtUdpPortsBase' + tempSerial).setAttribute("disabled", true);
											//document.getElementById('txtUdpPortsBase' + tempSerial).removeAttribute("disabled", true);
										}
									}
								}
								
								text = document.getElementById('txtDefaultImagePath');
								text.value = apicameradefaultimage;
								text = document.getElementById('txtDefaultVideoPath');
								text.value = apicameradefaultvideo;
								if(apiuseupdatestateevent == "true")
								{
									document.getElementById("chkUpdateStateEvent").setAttribute("checked", true);
								}
								else
								{
									document.getElementById("txtUpdateStateIntervallTimespan").removeAttribute("disabled");
								}
								if(apiuseupdatestateintervall == "true")
								{
									document.getElementById("chkUpdateStateIntervall").setAttribute("checked", true);
									document.getElementById("txtUpdateStateIntervallTimespan").removeAttribute("disabled");
								}
								else
								{
									document.getElementById("txtUpdateStateIntervallTimespan").setAttribute("disabled", true);
								}
								text = document.getElementById('txtUpdateStateIntervallTimespan');
								text.value=apiupdatestatetimespan;
								if(apiuseupdatelinks == "true")
								{
									document.getElementById("chkUseUpdateLinksIntervall").setAttribute("checked", true);
									document.getElementById("chkUpdateLinksOnlyWhenActive").removeAttribute("disabled");
									document.getElementById("txtUpdateLinksIntervallTimespan").removeAttribute("disabled");
								}
								else
								{
									document.getElementById("chkUpdateLinksOnlyWhenActive").setAttribute("disabled", true);
									document.getElementById("txtUpdateLinksIntervallTimespan").setAttribute("disabled", true);
								}
								if(apiuseupdatelinksonlywhenactive == "true")
								{
									document.getElementById("chkUpdateLinksOnlyWhenActive").setAttribute("checked", true);
								}
								text = document.getElementById('txtUpdateLinksIntervallTimespan');
								text.value=apiupdatelinkstimespan;
								if(api_use_pushservice == "true")
								{
									document.getElementById("chkUsePushService").setAttribute("checked", true);
								}
								if(apiloglevel == undefined || !(apiloglevel == "0" || apiloglevel == "1" || apiloglevel == "2" || apiloglevel == "3"))
								{
									document.getElementById("cbLogLevel").selectedIndex = "";
								}
								else
								{
									document.getElementById("cbLogLevel").selectedIndex = (Number.parseInt(apiloglevel)) + 1;
								}
								checkLogLevel(apiloglevel);
								document.getElementById("resultLoading").innerHTML = "";
								enableUIElements();
							}
							else
							{
								document.getElementById("resultLoading").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Einstellungen.<br /><small class="form-text text-muted">Rückgabewert 'success' ist 'false'.</small></div>`;
							}
						}
						catch (e)
						{
							document.getElementById("resultLoading").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Einstellungen.<br /><small class="form-text text-muted">${e}</small></div>`;
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("resultLoading").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Einstellungen.<br /><small class="form-text text-muted">Rückgabewert 'Status' ist '${this.status}'. Rückgabewert 'ReadyState' ist '4'.</small></div>`;
					}
					else
					{
						document.getElementById("resultLoading").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Laden der Einstellungen...</strong></div>`;
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}
			
			function loadSystemVariables()
			{
				var xmlHttp, objResp, objIter, sysVarName, sysVarInfo, sysVarAvailable, sysVarHint, sysVarTable = "";
				var url = `${location.protocol}//${location.hostname}:${port}/checkSystemVariables`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								sysVarHint  = `<div class="alert alert-primary fade show" role="alert">Die Option 'Systemvariablen bei API Aktionen automatisch aktualisieren' ist aktiviert. Somit aktualisiert das AddOn die entsprechenden Systemvariablen. In der folgenden Tabelle finden Sie alle Systemvariablen, die dieses AddOn auf der CCU benötigt. Wenn die jeweilige Zeile grün ist, ist die Systemvariable auf der CCU bereits angelegt, ansonsten ist die Zeile rot.<br />`;
								sysVarHint += `<small class="form-text text-muted">Bitte achten Sie darauf, dass alle Systemvariablen angelegt sind. Wenn Sie die Aktualisierung der Systemvariablen nicht wünschen, deaktivieren Sie bitte die Option 'Systemvariablen bei API Aktionen automatisch aktualisieren'.</small>`;
								sysVarHint += `</div>`;
								
								document.getElementById("divSystemVariablesHint").innerHTML = sysVarHint;
								
								sysVarTable = `<table class="table mb-0"><thead class="thead-dark"><tr><th scope="col">Status</th><th scope="col">Name der Systemvariable</th><th scope="col"></th></tr></thead><tbody>`;
								for (objIter in objResp.data)
								{
									sysVarName = objResp.data[objIter].sysVar_name;
									sysVarInfo = objResp.data[objIter].sysVar_info;
									sysVarAvailable = objResp.data[objIter].sysVar_available;
									if(sysVarAvailable==true)
									{
										sysVarTable += `<tr class="table-success"><th scope="row" class="align-middle">angelegt</th>`;
									}
									else
									{
										sysVarTable += `<tr class="table-danger"><th scope="row" class="align-middle">nicht angelegt</th>`;
									}
									sysVarTable += `<td class="text-break align-middle">${sysVarName}<br /><small class="form-text text-muted">${sysVarInfo}</small></td>`;

									if(sysVarAvailable==true)
									{
										sysVarTable += `<td class="align-middle"><button id="btn${sysVarName}" type="button" class="btn btn-primary mb-1" disabled>Systemvariable anlegen</button></td>`;
									}
									else
									{
										sysVarTable += `<td class="align-middle"><button id="btn${sysVarName}" onclick="createSysVar('${sysVarName}', '${sysVarInfo}')" type="button" class="btn btn-primary mb-1">Systemvariable anlegen</button></td>`;
									}

									sysVarTable += `</tr>`;
								}

								sysVarTable += `</tbody></table>`;

								document.getElementById("divSystemVariables").innerHTML = sysVarTable;
							}
							else
							{
								if(objResp.reason = "System variables in config disabled.")
								{
									document.getElementById("divSystemVariablesHint").innerHTML = "";
									document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-info mb-0" role="alert">Die Aktualisierung von Systemvariablen bei API Aktionen ist deaktiviert.</div>`;
								}
								else
								{
									document.getElementById("divSystemVariablesHint").innerHTML = "";
									document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger mb-0" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
								}
							}
						}
						catch (e)
						{
							document.getElementById("divSystemVariablesHint").innerHTML = "";
							document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger mb-0" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger mb-0" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
					}
					else
					{
						document.getElementById("divSystemVariables").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Laden der Systemvariablen...</strong></div>`;
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}
			
			function saveConfig()
			{
				var xmlHttp, obfFD;
				var url = `${location.protocol}//${location.hostname}:${port}/setConfig`;
				
				xmlHttp = new XMLHttpRequest();
				
				obfFD = new FormData(document.getElementById("configform"));
				
				xmlHttp.addEventListener("load", function(event) {
					//loadData();
				} );
				
				xmlHttp.addEventListener( "error", function( event ) {
					document.getElementById("resultMessage").innerHTML = "";
					$("#toastSaveConfigFailed").toast('show');
				} );
				
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							obfFD = JSON.parse(this.responseText);
							if(obfFD.success == true)
							{
								if(obfFD.serviceRestart == true)
								{
									document.getElementById("resultMessage").innerHTML = "";
									$("#toastSaveConfigOKRestart").toast('show');
								}
								else
								{
									document.getElementById("resultMessage").innerHTML = "";
									$("#toastSaveConfigOK").toast('show');
								}
								loadData();
								loadSystemVariables();
							}
							else
							{
								document.getElementById("resultMessage").innerHTML = "";
								$("#toastSaveConfigFailed").toast('show');
							}
						}
						catch (e)
						{
							document.getElementById("resultMessage").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei dem Speichern der Einstellungen.<br /><small class="form-text text-muted">${e}</small></div>`;
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("resultMessage").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei dem Speichern der Einstellungen.<br /><small class="form-text text-muted">Rückgabewert 'Status' ist '${this.status}'. Rückgabewert 'ReadyState' ist '4'.</small></div>`;
					}
					else
					{
						document.getElementById("resultMessage").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Einstellungen werden gespeichert...</strong></div>`;
					}
				};
				
				xmlHttp.open("POST", url);
				xmlHttp.send(obfFD);
			}
			
			function createSysVar(varName, varInfo)
			{
				var xmlHttp, objResp, text = "";
				var url = `${location.protocol}//${location.hostname}:${port}/createSystemVariable/${varName}/${varInfo}`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				text = `<table class="table"><thead><tr><th scope="col">Status</th><th scope="col">Name der Systemvariable</th><th scope="col"></th></tr></thead><tbody>`;
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								loadSystemVariables();
							}
							else
							{
								document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
							}
						}
						catch (e)
						{
							document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("divSystemVariables").innerHTML = `<div class="alert alert-danger" role="alert">Fehler bei der Ermittlung der Systemvariablen.</div>`;
					}
					else
					{
						document.getElementById("divSystemVariables").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Laden der Systemvariablen...</strong></div>`;
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}

			function removeTokenData()
			{
				var xmlHttp, objResp;
				var url = `${location.protocol}//${location.hostname}:${port}/removeTokenData`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true && objResp.dataRemoved == true)
							{
								$("#toastRemoveTokenOK").toast('show');
							}
							else
							{
								$("#toastRemoveTokenFailed").toast('show');
							}
						}
						catch (e)
						{
							$("#toastRemoveTokenFailed").toast('show');
						}
					}
					else if (this.readyState == 4)
					{
						
					}
					else
					{
						
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}

			function restartService()
			{
				var xmlHttp, objResp;
				var url = `${location.protocol}//${location.hostname}:${port}/restartService`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastRestartOK").toast('show');
							}
							else
							{
								$("#toastRestartFailed").toast('show');
							}
						}
						catch (e)
						{
							$("#toastRestartFailed").toast('show');
						}
					}
					else if (this.readyState == 4)
					{
						
					}
					else
					{
						
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}

			function downloadConfigFile()
			{
				var url = `${location.protocol}//${location.hostname}:${port}/downloadConfig`;
				window.open(url);
			}

			function enableButtons(enable)
			{
				if(enable == true)
				{
					document.getElementById("btnEnableTroubleShooting").setAttribute("onclick", "enableButtons(false)");
					document.getElementById("btnEnableTroubleShooting").setAttribute("class", "btn btn-warning btn-block");
					document.getElementById("btnEnableTroubleShooting").innerHTML = "Fehlerbehebung deaktivieren";
					document.getElementById("lblDeleteTokenData").removeAttribute("class");
					document.getElementById("btnDeleteTokenData").removeAttribute("disabled");
					document.getElementById("lblRestartService").removeAttribute("class");
					document.getElementById("btnRestartService").removeAttribute("disabled");
				}
				else
				{
					document.getElementById("btnEnableTroubleShooting").setAttribute("onclick", "enableButtons(true)");
					document.getElementById("btnEnableTroubleShooting").setAttribute("class", "btn btn-outline-warning btn-block");
					document.getElementById("btnEnableTroubleShooting").innerHTML = "Fehlerbehebung aktivieren";
					document.getElementById("lblDeleteTokenData").setAttribute("class", "text-muted");
					document.getElementById("btnDeleteTokenData").setAttribute("disabled", true);
					document.getElementById("lblRestartService").setAttribute("class", "text-muted");
					document.getElementById("btnRestartService").setAttribute("disabled", true);
				}
			}

			function changeValue(element)
			{
				switch (element.name)
				{
					case "useHttp":
						if(element.checked == true)
						{
							document.getElementById("txtPortHttp").removeAttribute("disabled");
						}
						else
						{
							if((element.checked == false) && (document.getElementById("chkUseHttps").checked == false))
							{
								$('#modalAtLeastOneNeedsActivation').modal('show');
								$('#modalAtLeastOneNeedsActivation').one('click', '.btn-primary', function() { checkCheckField(element.id); });
							}
							else
							{
								document.getElementById("txtPortHttp").setAttribute("disabled", true);
							}
						}
						break;
					case "useHttps":
						if(element.checked == true)
						{
							document.getElementById("txtPortHttps").removeAttribute("disabled");
							document.getElementById("txtHttpsKeyFile").removeAttribute("disabled");
							document.getElementById("txtHttpsCertFile").removeAttribute("disabled");
						}
						else
						{
							if((element.checked == false) && (document.getElementById("chkUseHttp").checked == false))
							{
								$('#modalAtLeastOneNeedsActivation').modal('show');
								$('#modalAtLeastOneNeedsActivation').one('click', '.btn-primary', function() { checkCheckField(element.id); });
							}
							else
							{
								document.getElementById("txtPortHttps").setAttribute("disabled", true);
								document.getElementById("txtHttpsKeyFile").setAttribute("disabled", true);
								document.getElementById("txtHttpsCertFile").setAttribute("disabled", true);
							}
						}
						break;
					case "useUdpStaticPorts":
						if(element.checked == true)
						{
							var element = document.getElementsByTagName("INPUT");
							for (var i=0, m=element.length; i<m; i++)
							{
								if(element[i].name.startsWith("udpPortsBase"))
								{
									var tempSerial = element[i].name.replace("udpPortsBase", "");
									document.getElementById('txtUdpPortsBase' + tempSerial).removeAttribute("disabled");
								}
							}
							//document.getElementById("txtUdpPorts").removeAttribute("disabled");
						}
						else
						{
							var element = document.getElementsByTagName("INPUT");
							for (var i=0, m=element.length; i<m; i++)
							{
								if(element[i].name.startsWith("udpPortsBase"))
								{
									var tempSerial = element[i].name.replace("udpPortsBase", "");
									document.getElementById('txtUdpPortsBase' + tempSerial).setAttribute("disabled", true);
								}
							}
							//document.getElementById("txtUdpPorts").setAttribute("disabled", true);
						}
						break;
					case "useUpdateStateIntervall":
						if(element.checked == true)
						{
							if(document.getElementById("chkUpdateStateEvent").checked == true)
							{
								$('#modalStateEventOrIntervall').modal('show');
								$('#modalStateEventOrIntervall').one('click', '.btn-primary', function() { uncheckCheckField("chkUpdateStateEvent"); });
							}
							document.getElementById("txtUpdateStateIntervallTimespan").removeAttribute("disabled");
						}
						else
						{
							document.getElementById("txtUpdateStateIntervallTimespan").setAttribute("disabled", true);
						}
						break;
					case "useUpdateLinksIntervall":
						if(element.checked == true)
						{
							document.getElementById("txtUpdateLinksIntervallTimespan").removeAttribute("disabled");
							document.getElementById("chkUpdateLinksOnlyWhenActive").removeAttribute("disabled");
						}
						else
						{
							document.getElementById("txtUpdateLinksIntervallTimespan").setAttribute("disabled", true);
							document.getElementById("chkUpdateLinksOnlyWhenActive").setAttribute("disabled", true);
						}
						break;
					case "useUpdateStateEvent":
						if(element.checked == true)
						{
							if(document.getElementById("chkUpdateStateIntervall").checked == true)
							{
								$('#modalStateEventOrIntervall').modal('show');
								$('#modalStateEventOrIntervall').one('click', '.btn-primary', function() { uncheckCheckField("chkUpdateStateIntervall"); });
								
							}
							document.getElementById("txtUpdateStateIntervallTimespan").setAttribute("disabled", true);
						}
						else
						{
							//document.getElementById("txtUpdateStateIntervallTimespan").removeAttribute("disabled");
						}
						break;
				}
			}

			function checkLogLevel(value)
			{
				if(value == "3")
				{
					document.getElementById("alertLogLevel").setAttribute("class", "alert alert-warning alert-dismissible fade show");
					document.getElementById("alertLogLevel").setAttribute("role", "alert");
					document.getElementById("alertLogLevel").innerHTML += "Sie haben den Umfang der Protokollierung so gewählt, dass zusätzlich auch DEBUG Informationen protokolliert werden. Dies kann zu einer sehr großen Protokolldatei führen. Wählen Sie für den normalen Betrieb einen Wert kleiner als 3 aus.<br />";
					document.getElementById("alertLogLevel").innerHTML += `<small class="form-text text-muted">Diese Einstellung bleibt dauerhaft auch nach einem Neustart des Addons oder der CCU aktiv.</small>`;
				}
				else
				{
					document.getElementById("alertLogLevel").removeAttribute("class");
					document.getElementById("alertLogLevel").removeAttribute("role");
					document.getElementById("alertLogLevel").innerHTML = "";
				}
			}

			function checkUDPPorts(elementName)
			{
				var element = document.getElementsByTagName("INPUT");
				var cnt = 0;
				var error = false;
				var errorMessage = "";
				var regex = new RegExp("^(1|[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$");
				for (var i=0, m=element.length; i<m; i++)
				{
					if(element[i].name.startsWith("udpPortsBase"))
					{
						cnt = cnt + 1;
					}
				}

				if(elementName.value == "")
				{
					return;
				}

				if(!regex.test(elementName.value))
				{
					error = true;
					errorMessage = "Sie haben keine Zahl oder eine ungültige Zahl eingegeben. Bitte geben Sie eine Zahl zwischen 1 und 65535 ein.<br /><br />Die Eingabe wird nun gelöscht."
				}

				if(error == false && cnt > 1)
				{
					for(var i=0, m=element.length; i<m; i++)
					{
						if(element[i].name.startsWith("udpPortsBase"))
						{
							var eName = 'txtUdpPortsBase' + element[i].name.replace("udpPortsBase", "");
							if(eName != elementName.id)
							{
								if(document.getElementById('txtUdpPortsBase' + element[i].name.replace("udpPortsBase", "")).value == elementName.value)
								{
									error = true;
									errorMessage = "Sie haben einen Port eingegeben, der bereits für eine andere HomeBase oder ein anderes Gerät eingegeben wurde.<br /><br />Die Eingabe wird nun gelöscht."
									break;
								}
							}
						}
					}
				}
				
				if(error == true)
				{
					var modal = $('#modalUDPPortsEqualWrong');
					modal.find(".modal-body").html(errorMessage);
					$('#modalUDPPortsEqualWrong').modal('show');
					$('#modalUDPPortsEqualWrong').one('click', '.btn-primary', function() { clearInputField(elementName.id); });
				}
			}

			function checkCheckField(elementName)
			{
				document.getElementById(elementName).checked = true;
			}

			function uncheckCheckField(elementName)
			{
				document.getElementById(elementName).checked = false;
			}

			function clearInputField(elementName)
			{
				document.getElementById(elementName).value = "";
			}
		</script>
	</body>
</html>
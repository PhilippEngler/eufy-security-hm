<!doctype html>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="Philipp Engler">
		<meta name="generator" content="Jekyll v4.1.1">
		<title>eufy Security AddOn für HomeMatic</title>
		
		<!-- Bootstrap core CSS -->
		<link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">
		
		<!-- Bootstrap icon font CSS -->
		<link href="assets/dist/css/bootstrap-icons.css" rel="stylesheet">
		
		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			
			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}
			
			.b-example-divider {
				height: 3rem;
				background-color: rgba(0, 0, 0, .1);
				border: solid rgba(0, 0, 0, .15);
				border-width: 1px 0;
				box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
			}
			
			.b-example-vr {
				flex-shrink: 0;
				width: 1.5rem;
				height: 100vh;
			}
			
			.bi {
				vertical-align: -.125em;
				fill: currentColor;
			}
			
			.nav-scroller {
				position: relative;
				z-index: 2;
				height: 2.75rem;
				overflow-y: hidden;
			}
			
			.nav-scroller .nav {
				display: flex;
				flex-wrap: nowrap;
				padding-bottom: 1rem;
				margin-top: -1px;
				overflow-x: auto;
				text-align: center;
				white-space: nowrap;
 				-webkit-overflow-scrolling: touch;
			}
		</style>
		
		<!-- Custom styles for this template -->
		<link href="assets/dist/css/navbar-top-fixed.css" rel="stylesheet">
		<link href="assets/dist/css/footer.css" rel="stylesheet">
		<link href="assets/dist/css/eufySecurityAddOn.css" rel="stylesheet">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark">
			<div class="container-fluid">
				<a id="lnkMain" class="navbar-brand" href="/addons/eufySecurity">eufy Security AddOn für HomeMatic</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarCollapse">
					<ul class="navbar-nav me-auto mb-2 mb-md-0">
						<li class="nav-item">
							<a id="lnkHome" class="nav-link" href="/addons/eufySecurity"">Home</a>
						</li>
						<li class="nav-item">
							<a id="lnkDevices" class="nav-link" href="devices.html">Geräte</a>
						</li>
						<li class="nav-item">
							<a id="lnkStatechange" class="nav-link active" aria-current="page" href="statechange.html">Statusänderung</a>
						</li>
						<li class="nav-item">
							<a id="lnkSettings" class="nav-link" href="settings.html">Einstellungen</a>
						</li>
						<li class="nav-item">
							<a id="lnkLogfiles" class="nav-link" href="logfiles.html">Logdateien</a>
						</li>
						<li class="nav-item active">
							<a id="lnkInfo" class="nav-link" href="info.html">Über</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		
		<main role="main" class="container-fluid">
			<div id="browserWarning">
			</div>
			<div id="loadApiSettingsError">
			</div>
			<div id="content">
				<h3>Statusänderung</h3>
				<p>Hier finden Sie den aktuellen Status Ihrer Basisstationen und können diesen entweder für eine Basisstation oder für alle Basisstationen ändern.</p>
				<p>
					<div id="allbases">
						<!--<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-5">-->
						<div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-2 row-cols-xl-3">
							<div class="col">
								<div class="card mb-3">
									<h5 class="card-header">alle Basen</h5>
									<div class="row no-gutters">
										<div class="card-body">
											<h6 class="card-subtitle mb-2 text-muted">Ändern des Status aller Basen</h6>
											<button id="btnArmAll" onclick="setArm('')" type="button" class="btn btn-primary my-2 me-3" disabled>abwesend</button>
											<button id="btnHomeAll" onclick="setHome('')" type="button" class="btn btn-primary my-2 me-3" disabled>zu Hause</button>
											<button id="btnScheduleAll" onclick="setSchedule('')" type="button" class="btn btn-primary my-2 me-3" disabled>Zeitsteuerung</button>
											<button id="btnDisarmAll" onclick="setDisarm('')" type="button" class="btn btn-primary my-2" disabled>deaktiviert</button>
										</div>
									</div>
									<div class="card-footer" id="lastEventTimeAll">
										
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="bases"></div>
				</p>
			</div>
		</main>
		
		<footer class="footer">
			<div class="container-fluid">
				<span class="text-muted">&copy; 2020-2022 Philipp Engler</span>
			</div>
		</footer>
		
		<div id="toastOK" class="toast bg-success" role="alert" data-autohide="true" data-delay="5000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="me-auto">Änderung des Status.</strong>
				<button type="button" class="ms-2 mb-1 close" data-dismiss="toast">&times;</button>
			</div>
			<div class="toast-body text-white">
				Die Änderung des Status wurde erfolgreich durchgeführt.
			</div>
		</div>
		<div id="toastFailed" class="toast bg-danger" role="alert" data-autohide="true" data-delay="5000" style="position: fixed; bottom: 10px; right: 10px;">
			<div class="toast-header">
				<strong class="me-auto">Änderung des Status.</strong>
				<button type="button" class="ms-2 mb-1 close" data-dismiss="toast">&times;</button>
			</div>
			<div class="toast-body text-white">
				Bei der Änderung des Status ist ein Fehler aufgetreten.
			</div>
		</div>
		
		<script src="assets/dist/js/bootstrap.bundle.min.js"></script>
		<script src="assets/dist/js/bootstrap.min.js"></script>
		<script>
			port = "";
			checkIE();
			
			function checkIE()
			{
				if (window.document.documentMode)
				{
					var warning =  "<div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\">";
					warning += "<h4>Diese Webseite ist nicht für den Internet Explorer entwickelt.</h4>";
					warning += "Die Funktionalität der Webseite kann beim Internet Explorer nicht sichergestellt werden. Nutzen Sie bitte Firefox, Microsoft Edge, Safari oder einen anderen unterstützen Browser.";
					warning += "</div>";
					document.getElementById("browserWarning").innerHTML = warning;
					document.getElementById("content").innerHTML = "";
				}
				else
				{
					if(!(window.location.search == ""))
					{
						addQueryStringToLinks(window.location.search);
					}
					getAPIPort();
				}
			}

			function addQueryStringToLinks(sessionID)
			{
				document.getElementById("lnkMain").setAttribute("href", document.getElementById("lnkHome").getAttribute("href") + sessionID);
				document.getElementById("lnkHome").setAttribute("href", document.getElementById("lnkHome").getAttribute("href") + sessionID);
				document.getElementById("lnkDevices").setAttribute("href", document.getElementById("lnkDevices").getAttribute("href") + sessionID);
				document.getElementById("lnkStatechange").setAttribute("href", document.getElementById("lnkStatechange").getAttribute("href") + sessionID);
				document.getElementById("lnkSettings").setAttribute("href", document.getElementById("lnkSettings").getAttribute("href") + sessionID);
				document.getElementById("lnkLogfiles").setAttribute("href", document.getElementById("lnkLogfiles").getAttribute("href") + sessionID);
				document.getElementById("lnkInfo").setAttribute("href", document.getElementById("lnkInfo").getAttribute("href") + sessionID);
			}

			function getAPIPort()
			{
				var apiPorts;
				var url = `${location.protocol}//${location.hostname}/addons/eufySecurity/apiPorts.txt`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('text/plain');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						try
						{
							apiPorts = this.responseText;
							apiPorts = apiPorts.split(",")
							
							if(apiPorts.length == 2)
							{
								port = apiPorts[0];
								if(location.protocol == "https:")
								{
									port = apiPorts[1];
								}
							}
							else
							{
								port = "52789";
								if(location.protocol == "https:")
								{
									port = "52790";
								}
							}

							initContent();
						}
						catch (e)
						{
							var loadSettingsError  = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
							loadSettingsError += `Bei der Ermittlung der API-Ports ist ein Fehler aufgetreten.<br />`;
							loadSettingsError += `<small class="text-muted">Bitte überprüfen Sie die Datei apiPorts.txt im Webseitenverzeichnisses dieses AddOns.</small>`;
							loadSettingsError += `</div>`;
							document.getElementById("loadApiSettingsError").innerHTML = loadSettingsError;;
						}
					}
					else if (this.readyState == 4)
					{
						var loadSettingsError  = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
						loadSettingsError += `Bei der Ermittlung der API-Ports ist ein Fehler aufgetreten.<br />`;
						loadSettingsError += `<small class="text-muted">Bitte überprüfen Sie die Datei apiPorts.txt im Webseitenverzeichnisses dieses AddOns.</small>`;
						loadSettingsError += `</div>`;
						document.getElementById("loadApiSettingsError").innerHTML = loadSettingsError;
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}

			function initContent()
			{
				loadData(true);
			}
			
			function loadData(showLoading)
			{
				var xmlHttp, objResp, objIter, bases = "", lastChangeTime;
				var lastChangeTimeAll = -1;
				var imagepath = "";
				var type = "";
				var state = "";
				var buttons = "";
				var url = `${location.protocol}//${location.hostname}:${port}/getBases`;
				xmlHttp = new XMLHttpRequest();
				xmlHttp.overrideMimeType('application/json');
				xmlHttp.onreadystatechange = function()
				{
					if (this.readyState == 4 && this.status == 200)
					{
						objResp = JSON.parse(this.responseText);
						if(objResp.success == true)
						{
							bases = `<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-5">`;
							for (objIter in objResp.data)
							{
								if(objResp.data[objIter].device_type == "basestation")
								{
									switch (objResp.data[objIter].model)
									{
										case "T8001":
											imagepath = `<img src="assets/devices/eufyHomeBase.png" class="card-img-top" alt="HomeBase">`;
											type="HomeBase";
											break;
										case "T8002":
											imagepath = `<img src="assets/devices/eufyHomeBase.png" class="card-img-top" alt="HomeBase E">`;
											type="HomeBase E";
											break;
										case "T8010":
											imagepath = `<img src="assets/devices/eufyHomeBase2.png" class="card-img-top" alt="HomeBase 2">`;
											type="HomeBase 2";
											break;
										default:
											imagepath = `<img src="assets/devices/eufyHomeBase2.png" class="card-img-top" alt="HomeBase">`;
											type="HomeBase";
									}
									switch (objResp.data[objIter].guard_mode)
									{
										case "0":
											state = "abwesend";
											buttons =  `<button id="btnArm${objResp.data[objIter].base_id}" type="button" class="btn btn-sm btn-primary mb-2 me-3" disabled>abwesend</button>`;
											buttons += `<button id="btnHome${objResp.data[objIter].base_id}" onclick="setHome('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">zu Hause</button>`;
											buttons += `<button id="btnSchedule${objResp.data[objIter].base_id}" onclick="setSchedule('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">Zeitsteuerung</button>`;
											buttons += `<button id="btnDisarm${objResp.data[objIter].base_id}" onclick="setDisarm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary my-2">deaktiviert</button>`;
											break;
										case "1":
											state = "zu Hause";
											buttons =  `<button id="btnArm${objResp.data[objIter].base_id}" onclick="setArm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">abwesend</button>`;
											buttons += `<button id="btnHome${objResp.data[objIter].base_id}" type="button" class="btn btn-sm btn-primary mb-2 me-3" disabled>zu Hause</button>`;
											buttons += `<button id="btnSchedule${objResp.data[objIter].base_id}" onclick="setSchedule('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">Zeitsteuerung</button>`;
											buttons += `<button id="btnDisarm${objResp.data[objIter].base_id}" onclick="setDisarm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary my-2">deaktiviert</button>`;
											break;
										case "2":
											state = "Zeitsteuerung";
											buttons =  `<button id="btnArm${objResp.data[objIter].base_id}" onclick="setArm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">abwesend</button>`;
											buttons += `<button id="btnHome${objResp.data[objIter].base_id}" onclick="setHome('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">zu Hause</button>`;
											buttons += `<button id="btnSchedule${objResp.data[objIter].base_id}" type="button" class="btn btn-sm btn-primary mb-2 me-3" disabled>Zeitsteuerung</button>`;
											buttons += `<button id="btnDisarm${objResp.data[objIter].base_id}" onclick="setDisarm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary my-2">deaktiviert</button>`;
											break;
										case "63":
											state = "deaktiviert";
											buttons =  `<button id="btnArm${objResp.data[objIter].base_id}" onclick="setArm('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">abwesend</button>`;
											buttons += `<button id="btnHome${objResp.data[objIter].base_id}" onclick="setHome('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">zu Hause</button>`;
											buttons += `<button id="btnSchedule${objResp.data[objIter].base_id}" onclick="setSchedule('${objResp.data[objIter].base_id}')" type="button" class="btn btn-sm btn-primary mb-2 me-3">Zeitsteuerung</button>`;
											buttons += `<button id="btnDisarm${objResp.data[objIter].base_id}" type="button" class="btn btn-sm btn-primary mb-2" disabled>deaktiviert</button>`;
											break;
										default:
											state="unbekannt";
									}
									bases += `<div class="col">`;
									bases += `<div class="card mb-3">`;
									bases += `<h5 class="card-header">${objResp.data[objIter].name}</h5>`;
									bases += `<div class="row no-gutters">`;
									bases += `<div class="col-md-4">${imagepath}</div>`;
									bases += `<div class="col-md-8">`;
									bases += `<div class="card-body" style="margin-left: -1rem">`;
									bases += `<h6 class="card-subtitle mb-2 text-muted">${type}</h6>`;
									bases += `<p class="card-text">${objResp.data[objIter].base_id}<br /><span class="text-nowrap"><i class="bi-shield" title="aktueller Status"></i>&nbsp;<span id="state_${objResp.data[objIter].base_id}">${state}</span></span></p>`;
									bases += `</div>`;
									bases += `</div>`;
									bases += `</div>`;
									//bases += `<div class="row no-gutters">`;
									bases += `<div class="card-body">${buttons}</div>`;
									//bases += `</div>`;
									if(objResp.data[objIter].guard_mode_last_change_time != "" && objResp.data[objIter].guard_mode_last_change_time != "undefined")
									{
										lastChangeTime = makeDateTimeString(new Date(parseInt(objResp.data[objIter].guard_mode_last_change_time)*1000));
										if(parseInt(objResp.data[objIter].guard_mode_last_change_time)*1000 > lastChangeTimeAll)
										{
											lastChangeTimeAll = parseInt(objResp.data[objIter].guard_mode_last_change_time*1000);
										}
									}
									else
									{
										lastChangeTime = "unbekannt";
									}
									bases += `<div class="card-footer"><small class="text-muted">Letzer Statuswechsel: ${lastChangeTime}</small></div>`;
									bases += `</div>`;
									bases += `</div>`;
								}
							}
							document.getElementById("btnArmAll").removeAttribute("disabled");
							document.getElementById("btnHomeAll").removeAttribute("disabled");
							document.getElementById("btnScheduleAll").removeAttribute("disabled");
							document.getElementById("btnDisarmAll").removeAttribute("disabled");
							document.getElementById("bases").innerHTML = bases;
							document.getElementById("lastEventTimeAll").innerHTML = `<small class="text-muted">Letzer Statuswechsel: ${makeDateTimeString(new Date(lastChangeTimeAll))}</small>`;
							type = "";
						}
						else
						{
							document.getElementById("btnArmAll").setAttribute("disabled", true);
							document.getElementById("btnHomeAll").setAttribute("disabled", true);
							document.getElementById("btnScheduleAll").setAttribute("disabled", true);
							document.getElementById("btnDisarmAll").setAttribute("disabled", true);
							document.getElementById("lastEventTimeAll").innerHTML = `<small class="text-muted">Letzer Statuswechsel: unbekannt</small>`;
							document.getElementById("bases").innerHTML = `<div class="alert alert-danger" role="alert">Fehler beim Laden der Basisstationen.</div>`;
						}
					}
					else if (this.readyState == 4)
					{
						document.getElementById("btnArmAll").setAttribute("disabled", true);
						document.getElementById("btnHomeAll").setAttribute("disabled", true);
						document.getElementById("btnScheduleAll").setAttribute("disabled", true);
						document.getElementById("btnDisarmAll").setAttribute("disabled", true);
						document.getElementById("lastEventTimeAll").innerHTML = `<small class="text-muted">Letzer Statuswechsel: unbekannt</small>`;
							document.getElementById("bases").innerHTML = `<div class="alert alert-danger" role="alert">Fehler beim Laden der Basisstationen.</div>`;
					}
					else
					{
						if(showLoading==true)
						{
							document.getElementById("btnArmAll").setAttribute("disabled", true);
							document.getElementById("btnHomeAll").setAttribute("disabled", true);
							document.getElementById("btnScheduleAll").setAttribute("disabled", true);
							document.getElementById("btnDisarmAll").setAttribute("disabled", true);
							document.getElementById("lastEventTimeAll").innerHTML = `<small class="text-muted">Letzer Statuswechsel: wird geladen...</small>`;
							document.getElementById("bases").innerHTML = `<div class="d-flex align-items-center"><div class="spinner-border m-4 float-left" role="status" aria-hidden="true"></div><strong>Lade verfügbare Basisstationen...</strong></div>`;
						}
					}
				};
				xmlHttp.open("GET", url, true);
				xmlHttp.send();
			}
			
			function setArm(baseserial)
			{
				if(baseserial == "")
				{
					document.getElementById("btnArmAll").innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;abwesend`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/away`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
							document.getElementById("btnArmAll").innerHTML = "abwesend";
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
				else
				{
					document.getElementById("btnArm" + baseserial).innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;abwesend`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/${baseserial}/away`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
			}
			
			function setHome(baseserial)
			{
				if(baseserial=="")
				{
					document.getElementById("btnHomeAll").innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;zu Hause`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/home`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
							document.getElementById("btnHomeAll").innerHTML = "zu Hause";
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
				else
				{
					document.getElementById("btnHome" + baseserial).innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;zu Hause`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/${baseserial}/home`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
			}
			
			function setSchedule(baseserial)
			{
				if(baseserial=="")
				{
					document.getElementById("btnScheduleAll").innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;Zeitsteuerung`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/schedule`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
							document.getElementById("btnScheduleAll").innerHTML = "Zeitsteuerung";
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
				else
				{
					document.getElementById("btnSchedule" + baseserial).innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;Zeitsteuerung`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/${baseserial}/schedule`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
						}
						else if (this.readyState == 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
			}
			
			function setDisarm(baseserial)
			{
				if(baseserial=="")
				{
					document.getElementById("btnDisarmAll").innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;deaktiviert`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/disarmed`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
							document.getElementById("btnDisarmAll").innerHTML = "deaktiviert";
						}
						else if (this.readyState != 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
				else
				{
					document.getElementById("btnDisarm" + baseserial).innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;deaktiviert`;
					var xmlHttp, objResp;
					var url = `${location.protocol}//${location.hostname}:${port}/setMode/${baseserial}/disarmed`;
					xmlHttp = new XMLHttpRequest();
					xmlHttp.overrideMimeType('application/json');
					xmlHttp.onreadystatechange = function()
					{
						if (this.readyState == 4 && this.status == 200)
						{
							objResp = JSON.parse(this.responseText);
							if(objResp.success == true)
							{
								$("#toastOK").toast('show');
								loadData(false);
							}
							else
							{
								$("#toastFailed").toast('show');
								loadData(false);
							}
						}
						else if (this.readyState != 4)
						{
							
						}
						else
						{
							
						}
					};
					xmlHttp.open("GET", url, true);
					xmlHttp.send();
				}
			}

			function makeDateTimeString(dateTime)
			{
				return (`${dateTime.getDate().toString().padStart(2,'0')}.${(dateTime.getMonth()+1).toString().padStart(2,'0')}.${dateTime.getFullYear().toString()} ${dateTime.getHours().toString().padStart(2,'0')}:${dateTime.getMinutes().toString().padStart(2,'0')}:${dateTime.getSeconds().toString().padStart(2,'0')}`);
			}
		</script>
	</body>
</html>